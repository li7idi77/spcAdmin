<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.easycompany.mapper.InstructorMapper">
	<!-- 유저 -->
	<select id="getBoardList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT BOARD_IDX,
	    CASE BOARD_TYPE
	 		WHEN 05 THEN '강사공지'
	 		WHEN 06 THEN '강사자료실'
		 END AS BOARD_TYPE,
	    TITLE, LINK_URL, FILE_ID, VIEW_CNT, CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19) ) AS REG_DT, REG_ID, REG_NM,
	    (SELECT COUNT(*) FROM edu_file WHERE FILE_KEY = BOARD_IDX AND FILE_GUBUN = 'board') AS FIEL_CNT, CONTENTS
	      FROM edu_board
	     WHERE USE_YN = 'Y'
	     <if test="searchCondition !=null and searchCondition == 'ALL'">
	      	AND (TITLE LIKE CONCAT('%', #{searchKeyword}, '%') OR REG_ID LIKE CONCAT('%', #{searchKeyword}, '%') OR CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%'))
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'TITLE'">
	      	AND TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'REG_NM'">
	      	AND REG_ID LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'CONTENTS'">
	      	AND CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchDate !=null and searchDate != 'ALL'">
	      	<![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{board_start_date} AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{board_end_date} 
	        ]]>
	      </if>
	      <if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	     ORDER BY BOARD_IDX DESC
	    LIMIT #{recordCountPerPage}  OFFSET  #{offset}
	</select>

	<select id="getBoardCount" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) cnt
	       FROM edu_board
	      WHERE USE_YN = 'Y'
	     <if test="searchCondition !=null and searchCondition == 'ALL'">
	      	AND (TITLE LIKE CONCAT('%', #{searchKeyword}, '%') OR REG_ID LIKE CONCAT('%', #{searchKeyword}, '%') OR CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%'))
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'TITLE'">
	      	AND TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'REG_NM'">
	      	AND REG_ID LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'CONTENTS'">
	      	AND CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchDate !=null and searchDate != 'ALL'">
	      	<![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{board_start_date} AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{board_end_date} 
	        ]]>
	      </if>
	      <if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	</select>
	
	<select id="getBoardView" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT BOARD_IDX, BOARD_TYPE, TITLE, CONTENTS, LINK_URL, FILE_ID, VIEW_CNT, CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19) ) AS REG_DT, REG_NM
		       ,EDU_TYPE_01, EDU_TYPE_02, EDU_TYPE_03, EDU_TYPE_04, EDU_TYPE_05, EDU_TYPE_06, EDU_TYPE_07, EDU_TYPE_08, EDU_TYPE_09, EDU_TYPE_10, EDU_TYPE_11
	      <![CDATA[
	      ,(SELECT b.BOARD_IDX FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX > #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX DESC LIMIT 1) AS NEXT_IDX
	      ,(SELECT b.TITLE FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX > #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX DESC LIMIT 1) AS NEXT_NM
	      ,(SELECT b.BOARD_IDX FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX < #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX LIMIT 1) AS PREV_IDX
	      ,(SELECT b.TITLE FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX < #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX LIMIT 1) AS PREV_NM
	      ]]>
	     <if test="board_type !=null and board_type == '06'">
		    , NOTICE_YN
         </if>
	      FROM edu_board
	     WHERE 1=1
	    	AND BOARD_IDX = #{board_idx}
	    	AND USE_YN = 'Y'
	    	<if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	</select>
	
	<select id="getInsActList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.SCHEDULE_NO, 
			   a.EDU_NAME,
			   a.EDU_START_DATE AS EDU_DATE,
               CONCAT(SUBSTR(TIME(b.START_TIME),1,2),':',SUBSTR(TIME(b.START_TIME),4,2),'~',SUBSTR(TIME(b.END_TIME),1,2),':',SUBSTR(TIME(b.END_TIME),4,2)) AS EDU_DATETIME,
               (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = b.COPER_AREA_CD) AS AREA_NM,
               a.EDU_ORG_NAME, b.EDU_PLACE, a.EDU_NUMBER,
               a.EDU_TARGET, a.EDU_TEAC_NAME,
               CASE WHEN b.INS_TYPE = 'recruit' AND INS_STATUS IS NULL THEN '섭외중'
					WHEN b.INS_TYPE = 'recruit' AND INS_STATUS IS NOT NULL THEN '완료'
					WHEN b.INS_TYPE = 'select' AND INS_STATUS IS NULL THEN '완료'
					WHEN b.INS_TYPE = 'input' AND INS_STATUS IS NULL THEN '완료'
				END
               AS INS_STATUS,
               b.SCH_STATUS,
               a.EDU_KEY,
               (SELECT 'Y' FROM EDU_SCHEDULE_APP WHERE INS_USER = #{UserAccount.user_id}) AS INS_APP_CHECK
		FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
		AND b.INS_TYPE = 'recruit'
        AND b.INS_STATUS IS NULL
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name !=null and edu_name != ''">
	      	AND a.EDU_NAME LIKE CONCAT('%', #{edu_name}, '%')
	    </if>
	    <if test="edu_name !=null and area_nm != ''">
	      	AND b.COPER_AREA_CD = #{area_nm}
	    </if>
	    <if test="orgSearch !=null and orgSearch == 'TEXT'">
	      	AND a.EDU_ORG_NAME LIKE CONCAT('%', #{edu_org_name}, '%')
	    </if>
	    ORDER BY a.SCHEDULE_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getInsActListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		 FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
		AND b.INS_TYPE = 'recruit'
        AND b.INS_STATUS IS NULL
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name !=null and edu_name != ''">
	      	AND a.EDU_NAME LIKE CONCAT('%', #{edu_name}, '%')
	    </if>
	    <if test="edu_name !=null and area_nm != ''">
	      	AND b.COPER_AREA_CD = #{area_nm}
	    </if>
	    <if test="orgSearch !=null and orgSearch == 'TEXT'">
	      	AND a.EDU_ORG_NAME LIKE CONCAT('%', #{edu_org_name}, '%')
	    </if>
	</select>
	
	<insert id="instructor03Save" parameterType="java.util.Map">	
		INSERT INTO EDU_SCHEDULE_APP
		(SCHEDULE_NO,EDU_KEY,INS_USER,REG_DT,REG_ID)
		VALUES(#{sch_no},#{edu_no},#{app_user},DATE_FORMAT(NOW(),'%x-%m-%d'),#{UserAccount.user_id})
	</insert>
	
	<select id="getInsLectureList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.SCHEDULE_NO, 
			   a.EDU_NAME,
			   a.EDU_START_DATE AS EDU_DATE,
               CONCAT(SUBSTR(TIME(b.START_TIME),1,2),':',SUBSTR(TIME(b.START_TIME),4,2),'~',SUBSTR(TIME(b.END_TIME),1,2),':',SUBSTR(TIME(b.END_TIME),4,2)) AS EDU_DATETIME,
               (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = b.COPER_AREA_CD) AS AREA_NM,
               a.EDU_ORG_NAME, b.EDU_PLACE, a.EDU_NUMBER,
               a.EDU_TARGET, a.EDU_TEAC_NAME,
               CASE WHEN b.INS_TYPE = 'recruit' AND INS_STATUS IS NULL THEN '섭외중'
					WHEN b.INS_TYPE = 'recruit' AND INS_STATUS IS NOT NULL THEN '완료'
					WHEN b.INS_TYPE = 'select' AND INS_STATUS IS NULL THEN '완료'
					WHEN b.INS_TYPE = 'input' AND INS_STATUS IS NULL THEN '완료'
				END
               AS INS_STATUS,
               b.SCH_STATUS,
               a.EDU_KEY,
               (SELECT 'Y' FROM EDU_SCHEDULE_APP WHERE INS_USER = #{UserAccount.user_id}) AS INS_APP_CHECK
		FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
        AND a.EDU_TEAC_ID = #{UserAccount.user_id}
		<if test=" category1_key !=null and category1_key !=0">
			AND a.CATEGORY1_KEY = #{category1_key} 
		</if>
		<if test=" category2_key !=null and category2_key !=0 ">
			AND a.CATEGORY2_KEY = #{category2_key} 
		</if>
		<if test=" category3_key !=null and category3_key !=0">
			AND a.CATEGORY3_KEY = #{category3_key} 
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name !=null and edu_name != ''">
	      	AND a.EDU_NAME LIKE CONCAT('%', #{edu_name}, '%')
	    </if>
	    <if test="edu_name !=null and area_nm != ''">
	      	AND b.COPER_AREA_CD = #{area_nm}
	    </if>
	    <if test="orgSearch !=null and orgSearch == 'TEXT'">
	      	AND a.EDU_ORG_NAME LIKE CONCAT('%', #{edu_org_name}, '%')
	    </if>
	    ORDER BY a.SCHEDULE_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getInsLectureListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		 FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
        AND a.EDU_TEAC_ID = #{UserAccount.user_id}
		<if test=" category1_key !=null and category1_key !=0">
			AND a.CATEGORY1_KEY = #{category1_key} 
		</if>
		<if test=" category2_key !=null and category2_key !=0 ">
			AND a.CATEGORY2_KEY = #{category2_key} 
		</if>
		<if test=" category3_key !=null and category3_key !=0">
			AND a.CATEGORY3_KEY = #{category3_key} 
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name !=null and edu_name != ''">
	      	AND a.EDU_NAME LIKE CONCAT('%', #{edu_name}, '%')
	    </if>
	    <if test="edu_name !=null and area_nm != ''">
	      	AND b.COPER_AREA_CD = #{area_nm}
	    </if>
	    <if test="orgSearch !=null and orgSearch == 'TEXT'">
	      	AND a.EDU_ORG_NAME LIKE CONCAT('%', #{edu_org_name}, '%')
	    </if>
	</select>
	
	<select id="getInsLectureAllCnt" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT COUNT(a.SCHEDULE_NO) AS ALL_CNT,
			   COUNT(CASE WHEN DATE_FORMAT(a.EDU_START_DATE,'%Y') = DATE_FORMAT(NOW(),'%x') THEN 1 END) AS CNT
		FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
        AND a.EDU_TEAC_ID = #{UserAccount.user_id}
        <if test=" category1_key !=null and category1_key !=0">
			AND a.CATEGORY1_KEY = #{category1_key} 
		</if>
		<if test=" category2_key !=null and category2_key !=0 ">
			AND a.CATEGORY2_KEY = #{category2_key} 
		</if>
		<if test=" category3_key !=null and category3_key !=0">
			AND a.CATEGORY3_KEY = #{category3_key} 
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name !=null and edu_name != ''">
	      	AND a.EDU_NAME LIKE CONCAT('%', #{edu_name}, '%')
	    </if>
	    <if test="edu_name !=null and area_nm != ''">
	      	AND b.COPER_AREA_CD = #{area_nm}
	    </if>
	    <if test="orgSearch !=null and orgSearch == 'TEXT'">
	      	AND a.EDU_ORG_NAME LIKE CONCAT('%', #{edu_org_name}, '%')
	    </if>
	</select>
	
	<insert id="instructor04Save" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="instructor_leave_idx">	
		INSERT INTO EDU_INSTRUCTOR_LEAVE 
		(INSTRUCTOR_IDX, REASON, S_DATE, E_DATE, REG_DT, REG_ID)
		SELECT  a.INSTRUCTOR_IDX, 
					#{reason} AS REASON,
		            DATE_FORMAT(#{s_date},'%x-%m-%d') AS S_DATE,
		            DATE_FORMAT(#{e_date},'%x-%m-%d') AS E_DATE,
		            DATE_FORMAT(NOW(),'%x-%m-%d') AS REG_DT,
		            #{UserAccount.user_id} AS REG_ID
			FROM EDU_INSTRUCTOR a WHERE a.COM_USER_ID = #{UserAccount.user_id}
	</insert>
	
	<select id="getInsEduAppList" parameterType="java.util.Map" resultType="java.util.Map">
		<![CDATA[
		SELECT (select CATEGORY3_NAME From EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = a.CATEGORY3_KEY AND CATEGORY2_KEY = a.CATEGORY2_KEY AND CATEGORY1_KEY = a.CATEGORY1_KEY) AS EDU_NAME,
				a.TRAIN_S_DATE, a.TRAIN_E_DATE,
                a.EDU_METHOD, a.EDU_NO,
                (CASE WHEN a.TRAIN_S_DATE <= NOW() AND a.TRAIN_E_DATE >= NOW() THEN '교육중' 
					  WHEN a.TRAIN_E_DATE < NOW() THEN '교육종료'
				 END) AS EDU_STATUS,
				 ]]>
				CASE b.COUR_STAT
			 		WHEN 1 THEN '완료'
			 		ELSE '미완료'
				 END AS COUR_STAT,     
                (CASE WHEN b.COUR_NO != '' THEN 'Y' END) AS APP_CHK
        FROM (SELECT *
				FROM EDU_REGISTRATION
		        WHERE 1=1
		        AND CATEGORY1_KEY = '3' 
				AND CATEGORY2_KEY = '7'
				<if test="start_date !=null and start_date !=''">
				    <![CDATA[
				     AND TRAIN_S_DATE >= #{start_date}
				    ]]>
				</if>
				<if test="end_date !=null and end_date !=''">
					<![CDATA[
				     AND TRAIN_E_DATE <= #{end_date}
				    ]]> 
				</if>	
				)a 
		LEFT JOIN EDU_COURSE_REGISTRATION b
		ON a.EDU_NO = b.EDU_NO
        AND b.USER_ID = #{UserAccount.user_id} 
		
		<if test="edu_nm != '' and edu_nm != null and eduSearch =='TEXT'">
			AND a.CATEGORY3_KEY IN (SELECT CATEGORY3_KEY FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_NAME LIKE CONCAT('%',#{edu_nm},'%'))
		</if>
		ORDER BY EDU_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
		
	</select>
	
	<select id="getInsEduAppListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM (SELECT *
				FROM EDU_REGISTRATION
		        WHERE 1=1
		        AND CATEGORY1_KEY = '3' 
				AND CATEGORY2_KEY = '7'
				<if test="start_date !=null and start_date !=''">
				    <![CDATA[
				     AND TRAIN_S_DATE >= #{start_date}
				    ]]>
				</if>
				<if test="end_date !=null and end_date !=''">
					<![CDATA[
				     AND TRAIN_E_DATE <= #{end_date}
				    ]]> 
				</if>	
				)a 
		LEFT JOIN EDU_COURSE_REGISTRATION b
		ON a.EDU_NO = b.EDU_NO
        AND b.USER_ID = #{UserAccount.user_id} 
		<if test="edu_nm != '' and edu_nm != null and eduSearch =='TEXT'">
			AND a.CATEGORY3_KEY IN (SELECT CATEGORY3_KEY FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_NAME LIKE CONCAT('%',#{edu_nm},'%'))
		</if>
	</select>
	
	<insert id="instructor05Save" parameterType="java.util.Map">	
		INSERT INTO EDU_COURSE_REGISTRATION(
		  	  COUR_NO
		  	, EDU_NO
		  	, USER_ID
		  	, USER_NM
		  	, EML_ADDR
		  	, MBL_TELNO
		  	, REG_ID
		) VALUES (
			  (SELECT MAX(a.COUR_NO)+1 FROM EDU_COURSE_REGISTRATION a)
			, #{edu_no}
			, #{UserAccount.user_id}
			, #{UserAccount.user_nm}
			, #{UserAccount.eml_addr}
			, #{UserAccount.mbl_telno}
			, #{UserAccount.user_id}
		)	
	</insert>
	<!-- 관리자 -->
	
	<select id="getInstructorAllCnt" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT COUNT(tb.USER_ID) AS ALL_CNT
			  ,COUNT(CASE tb.STATUS WHEN '1' THEN 1 END) AS CNT1
			  ,COUNT(CASE tb.STATUS WHEN '2' THEN 1 END) AS CNT2
			  ,COUNT(CASE tb.STATUS WHEN '3' THEN 1 END) AS CNT3
        FROM (
        SELECT  a.USER_ID,b.STATUS
		FROM EDU_INSTRUCTOR b,
				 COM_USER a
			where 1=1
	        AND b.COM_USER_ID = a.USER_ID
			AND a.EDU_AUTHOR_CD IN ('03','04')
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.LICENSE_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.LICENSE_DT >= #{start_date} AND a.LICENSE_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.INSTR_INST_ND_ENTRPS_NM LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND a.RGN_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" ins_nm !=null and ins_nm !=''">
			AND FN_DECRYPT(a.ENCPT_USER_NM) LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" status_type !=null and status_type !='' and status_type != 'ALL'">
			AND b.STATUS = #{status_type}
		</if>
		<if test=" class_type !=null and class_type !='' and class_type != 'ALL'">
			AND b.CLASS = #{class_type}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.USER_ID IN (SELECT DISTINCT USER_ID FROM COM_USER_EDU_INFO WHERE CAST(EDU_INFO_CD AS unsigned) = #{category3_key})
		</if>
        ) tb
	</select>
	
	<select id="getInstructorList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT CASE WHEN b.STATUS = '1' THEN '활동' 
			   WHEN b.STATUS = '2' THEN '상실' 
		       WHEN b.STATUS = '3' THEN '휴직' 
			END AS INS_STATUS,
	       a.USER_ID,
	       FN_DECRYPT(a.ENCPT_USER_NM) AS USER_NM,
	       CASE WHEN b.CLASS = '1' THEN '일반' 
			   WHEN b.CLASS = '2' THEN '실무자' 
			   WHEN b.CLASS = '3' THEN '기관' 
			   WHEN b.CLASS = '4' THEN '기업' 
		   END AS INS_CLASS,
		   CASE
			   WHEN FN_DECRYPT(a.ENCPT_SEXDSTN_SE) = 'M' THEN '남자'
			   WHEN FN_DECRYPT(a.ENCPT_SEXDSTN_SE) = 'W' THEN '여자'
			   ELSE FN_DECRYPT(a.ENCPT_SEXDSTN_SE)
			  END AS USER_SEX_NM,	
		   a.EML_ADDR, FN_DECRYPT(a.ENCPT_MBL_TELNO) AS MBL_TELNO, a.INSTR_INST_ND_ENTRPS_NM AS INSTRUCTOR_COPER_NM,    
	       (SELECT COUNT(*) FROM EDU_SCHEDULE WHERE EDU_TEAC_ID = a.USER_ID AND DATE_FORMAT(EDU_START_DATE,'%Y') = DATE_FORMAT(NOW(),'%Y')) AS EDU_COUNT,
		   (SELECT COUNT(*) FROM EDU_SCHEDULE WHERE EDU_TEAC_ID = a.USER_ID) AS EDU_ALL_COUNT,
		   (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = a.RGN_CD) AS AREA_NM,
		   b.REG_DT AS LICENSE_DT, b.INS_OFF_STATUS, 
		   IFNULL(b.INS_ON_STATUS,
	       CASE WHEN (SELECT COUNT(*) FROM EDU_COURSE_REGISTRATION WHERE USER_ID = a.USER_ID AND EDU_NO IN (SELECT EDU_NO FROM EDU_REGISTRATION WHERE CATEGORY1_KEY = '3' AND CATEGORY2_KEY = '7')) > 0 THEN '1'
				ELSE '0' END) AS INS_ON_STATUS,
		   b.INSTRUCTOR_IDX
			FROM EDU_INSTRUCTOR b,
				 COM_USER a
			where 1=1
	        AND b.COM_USER_ID = a.USER_ID
			AND a.EDU_AUTHOR_CD IN ('03','04')
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.LICENSE_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.LICENSE_DT >= #{start_date} AND a.LICENSE_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.INSTR_INST_ND_ENTRPS_NM LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND a.RGN_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" ins_nm !=null and ins_nm !=''">
			AND FN_DECRYPT(a.ENCPT_USER_NM) LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" status_type !=null and status_type !='' and status_type != 'ALL'">
			AND b.STATUS = #{status_type}
		</if>
		<if test=" class_type !=null and class_type !='' and class_type != 'ALL'">
			AND b.CLASS = #{class_type}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.USER_ID IN (SELECT DISTINCT USER_ID FROM COM_USER_EDU_INFO WHERE CAST(EDU_INFO_CD AS unsigned) = #{category3_key})
		</if>
		ORDER BY b.INSTRUCTOR_IDX DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>

	<select id="getInstructorListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_INSTRUCTOR b,
				 COM_USER a
			where 1=1
	        AND b.COM_USER_ID = a.USER_ID
			AND a.EDU_AUTHOR_CD IN ('03','04')
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.LICENSE_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.LICENSE_DT >= #{start_date} AND a.LICENSE_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.INSTR_INST_ND_ENTRPS_NM LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND a.RGN_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" ins_nm !=null and ins_nm !=''">
			AND FN_DECRYPT(a.ENCPT_USER_NM) LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" status_type !=null and status_type !='' and status_type != 'ALL'">
			AND b.STATUS = #{status_type}
		</if>
		<if test=" class_type !=null and class_type !='' and class_type != 'ALL'">
			AND b.CLASS = #{class_type}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.USER_ID IN (SELECT DISTINCT USER_ID FROM COM_USER_EDU_INFO WHERE CAST(EDU_INFO_CD AS unsigned) = #{category3_key})
		</if>
	</select>
	
	<select id="getCodeList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT CD, CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '${code}'
	</select>
	
	<select id="getInstructorView" parameterType="java.util.Map" resultType="java.util.Map">	
		SELECT (SELECT COUNT(*) FROM EDU_INSTRUCTOR_LEAVE WHERE INSTRUCTOR_IDX = b.INSTRUCTOR_IDX AND STATUS = 1) AS LEAVE_CNT,
			   (SELECT S_DATE FROM EDU_INSTRUCTOR_LEAVE WHERE INSTRUCTOR_IDX = b.INSTRUCTOR_IDX AND STATUS = 1 ORDER BY E_DATE DESC LIMIT 0,1) AS LEAVE_SDATE,
			   (SELECT E_DATE FROM EDU_INSTRUCTOR_LEAVE WHERE INSTRUCTOR_IDX = b.INSTRUCTOR_IDX AND STATUS = 1 ORDER BY E_DATE DESC LIMIT 0,1) AS LEAVE_EDATE,
			   (SELECT FILE_NAME FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = (SELECT INSTRUCTOR_LEAVE_IDX FROM EDU_INSTRUCTOR_LEAVE WHERE INSTRUCTOR_IDX = b.INSTRUCTOR_IDX AND STATUS = 1 ORDER BY E_DATE DESC LIMIT 0,1)) AS LEAVE_FILE_NAME,
			   (SELECT FILE_ID FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = (SELECT INSTRUCTOR_LEAVE_IDX FROM EDU_INSTRUCTOR_LEAVE WHERE INSTRUCTOR_IDX = b.INSTRUCTOR_IDX AND STATUS = 1 ORDER BY E_DATE DESC LIMIT 0,1)) AS LEAVE_FILE_ID,
			   (SELECT CONCAT('교육 제',DATE_FORMAT(NOW(),'%y'),'-',LICENSE_NUMBER,'호') FROM EDU_USER_LICENSE WHERE CATEGORY1_KEY = '3' AND CATEGORY2_KEY = '7' AND USER_ID = a.USER_ID) AS LICENSE_NUMBER,
               (SELECT REG_DT FROM EDU_USER_LICENSE WHERE CATEGORY1_KEY = '3' AND CATEGORY2_KEY = '7' AND USER_ID = a.USER_ID) AS LICENSE_DATE,
               (SELECT COUNT(*) FROM EDU_SCHEDULE WHERE EDU_TEAC_ID = a.USER_ID) AS EDU_ALLCNT,
               (SELECT COUNT(CASE WHEN DATE_FORMAT(EDU_START_DATE,'%Y') = DATE_FORMAT(NOW(),'%Y') THEN 1 END) FROM EDU_SCHEDULE WHERE EDU_TEAC_ID = a.USER_ID) AS EDU_NOWCNT,
               b.INS_OFF_STATUS, b.INS_ON_STATUS, b.STATUS AS INS_STATUS, b.CLASS AS INS_CLASS,
               (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = a.RGN_CD) AS AREA_NM,
			       a.*, CASE
					   WHEN FN_DECRYPT(a.ENCPT_SEXDSTN_SE) = 'M' THEN '남자'
					   WHEN FN_DECRYPT(a.ENCPT_SEXDSTN_SE) = 'W' THEN '여자'
					   ELSE FN_DECRYPT(a.ENCPT_SEXDSTN_SE)
				      END AS USER_SEX_NM,
			   b.INSTRUCTOR_IDX
		FROM EDU_INSTRUCTOR b,
			 COM_USER a
			WHERE 1=1
	        AND b.COM_USER_ID = a.USER_ID
	        AND a.USER_ID = #{user_id}
			AND a.EDU_AUTHOR_CD IN ('03','04')
	</select>
		
	<select id="getInsAuthList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  b.CATEGORY3_NAME, DATE_FORMAT(a.REG_DT,'%x-%m-%d') AS EDU_FDATE,
					IFNULL(a.EDU_AUTHOR_BGNG_DT,DATE_FORMAT(a.REG_DT,'%x-%m-%d')) AS AUTH_SDATE, 
                    IFNULL(a.EDU_AUTHOR_END_DT,CONCAT(DATE_FORMAT(a.REG_DT,'%Y')+1,'-12-31')) AS AUTH_EDATE,
                    a.EDU_INFO_CD AS EDU_CD
            FROM COM_USER_EDU_INFO a,
				 EDU_CLASS_CATEGORY3 b
			WHERE a.EDU_INFO_CD = b.CD_NO
            AND a.USER_ID = #{user_id}
            ORDER BY EDU_INFO_CD ASC
	</select>	
		
	<update id="updateInstructorAuthData" parameterType="java.util.Map">
		UPDATE COM_USER_EDU_INFO
		   SET  EDU_AUTHOR_BGNG_DT = #{auth_sdate},
		   		EDU_AUTHOR_END_DT = #{auth_edate}
 		 WHERE USER_ID = #{user_id}
 		 AND EDU_INFO_CD = #{edu_cd}
	</update>
		
	<update id="updateInstructorData" parameterType="java.util.Map">	
		 UPDATE EDU_INSTRUCTOR
		   SET  STATUS = #{status},
		   		CLASS = #{class},
		   		INS_OFF_STATUS = #{ins_off_stat},
		   		INS_ON_STATUS = #{ins_on_stat}
 		 WHERE COM_USER_ID = #{user_id}
	</update>
	
	<select id="getInsEduChk" parameterType="java.util.Map" resultType="java.util.Map">
		select (CASE WHEN a.INS_OFF_STATUS = 1 THEN 1 ELSE 0 END + 
					CASE WHEN a.INS_ON_STATUS = 1 THEN 1 ELSE 0 END) as result
			from EDU_INSTRUCTOR a 
            where a.COM_USER_ID = #{user_id}
	</select>
	
	<update id="updateInsEduAuth" parameterType="java.util.Map">	
		 UPDATE COM_USER_EDU_INFO a
		   SET  EDU_AUTHOR_END_DT = CONCAT(DATE_FORMAT(a.EDU_AUTHOR_END_DT,'%Y')+1,'-12-31')
 		 WHERE a.USER_ID = #{user_id}
	</update>
	
	<select id="getMyEduInfo" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.COM_USER_ID,b.INSTR_INST_ND_ENTRPS_NM AS INSTRUCTOR_COPER_NM,
				(SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = b.RGN_CD) AS AREA_NM,
				FN_DECRYPT(b.ENCPT_MBL_TELNO) AS MBL_TELNO,
				(SELECT CONCAT('교육 제',DATE_FORMAT(NOW(),'%y'),'-',LICENSE_NUMBER,'호') FROM EDU_USER_LICENSE WHERE CATEGORY1_KEY = '1' AND CATEGORY1_KEY = '2' AND USER_ID = a.COM_USER_ID) AS LICENSE_NUMBER,
                b.REG_DT,
				CASE WHEN a.STATUS = '1' THEN '활동강사'
					 WHEN a.STATUS = '2' THEN '상실강사'
					 WHEN a.STATUS = '3' THEN '휴직강사'
				END AS STATUS
		FROM EDU_INSTRUCTOR a,
			 COM_USER b
		WHERE a.COM_USER_ID = b.USER_ID
		AND a.COM_USER_ID = #{UserAccount.user_id}
	</select>
	
	<select id="getMyEduAuthList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  a.CATEGORY3_NAME,
				b.EDU_INFO_CD AS EDU_CD,
		        IFNULL(b.EDU_AUTHOR_BGNG_DT,DATE_FORMAT(b.REG_DT,'%x-%m-%d')) AS AUTH_SDATE, 
                IFNULL(b.EDU_AUTHOR_END_DT,CONCAT(DATE_FORMAT(b.REG_DT,'%Y')+1,'-12-31')) AS AUTH_EDATE
		FROM (SELECT * 
			FROM EDU_CLASS_CATEGORY3
		    WHERE CATEGORY1_KEY = '7' 
			AND CD_NO IS NOT NULL) a
		    LEFT JOIN COM_USER_EDU_INFO b
		ON a.CD_NO = b.EDU_INFO_CD
		AND a.CATEGORY1_KEY = '7' 
		AND a.CD_NO IS NOT NULL 
		AND b.USER_ID = #{UserAccount.user_id}
		ORDER BY CAST(a.CD_NO AS unsigned)
	</select>
	
	<select id="getInsEduList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT CASE WHEN c.STATUS = '1' THEN '활동' 
					WHEN c.STATUS = '2' THEN '상실' 
					WHEN c.STATUS = '3' THEN '휴직' 
				END AS STATUS,
				CASE WHEN c.CLASS = '1' THEN '일반' 
				   WHEN c.CLASS = '2' THEN '실무자' 
				   WHEN c.CLASS = '3' THEN '기관' 
				   WHEN c.CLASS = '4' THEN '기업' 
			   END AS CLASS,
				d.USER_ID, FN_DECRYPT(d.ENCPT_USER_NM) AS USER_NM, d.EML_ADDR, FN_DECRYPT(d.ENCPT_MBL_TELNO) AS MBL_TELNO, a.EDU_ORG_NAME,
		        CASE WHEN FN_DECRYPT(d.ENCPT_SEXDSTN_SE) = 'M' THEN '남' ELSE '여' END AS USER_SEX,
		        (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY1_NAME,
		        (SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = a.CATEGORY2_KEY AND CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY2_NAME,
		        (SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = a.CATEGORY3_KEY AND CATEGORY2_KEY = a.CATEGORY2_KEY AND CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY3_NAME,
		        a.EDU_TARGET, a.EDU_NUMBER, e.EDU_PLACE, a.SCHEDULE_NO, a.EDU_START_DATE,
		        (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = e.COPER_AREA_CD) AS AREA_NM
		FROM EDU_SCHEDULE a,
			 EDU_REGISTRATION b,
		     EDU_INSTRUCTOR c,
		     COM_USER d,
		     EDU_SCHEDULE_DETAIL e
		WHERE a.EDU_KEY = b.EDU_NO
		AND a.EDU_TEAC_ID = c.COM_USER_ID
		AND c.COM_USER_ID = d.USER_ID
		AND a.SCHEDULE_NO = e.SCHEDULE_NO
		AND a.EDU_TEAC_ID IS NOT NULL
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{org_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND e.COPER_AREA_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" ins_nm !=null and ins_nm !=''">
			AND FN_DECRYPT(d.ENCPT_USER_NM) LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" stat_type !=null and stat_type !='' and stat_type != 'ALL'">
			AND b.STATUS = #{stat_type}
		</if>
		<if test=" ins_type !=null and ins_type !='' and ins_type != 'ALL'">
			AND b.CLASS = #{ins_type}
		</if>
		<if test=" category2_key !=null and category2_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY2_KEY =  #{category2_key}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY3_KEY =  #{category3_key}
		</if>
		ORDER BY a.SCHEDULE_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>

	<select id="getInsEduListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_SCHEDULE a,
			 EDU_REGISTRATION b,
		     EDU_INSTRUCTOR c,
		     COM_USER d,
		     EDU_SCHEDULE_DETAIL e
		WHERE a.EDU_KEY = b.EDU_NO
		AND a.EDU_TEAC_ID = c.COM_USER_ID
		AND c.COM_USER_ID = d.USER_ID
		AND a.SCHEDULE_NO = e.SCHEDULE_NO
		AND a.EDU_TEAC_ID IS NOT NULL
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.EDU_START_DATE >= #{start_date} AND a.EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{org_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND e.COPER_AREA_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" ins_nm !=null and ins_nm !=''">
			AND FN_DECRYPT(d.ENCPT_USER_NM) LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test=" stat_type !=null and stat_type !='' and stat_type != 'ALL'">
			AND b.STATUS = #{stat_type}
		</if>
		<if test=" ins_type !=null and ins_type !='' and ins_type != 'ALL'">
			AND b.CLASS = #{ins_type}
		</if>
		<if test=" category2_key !=null and category2_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY2_KEY =  #{category2_key}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY3_KEY =  #{category3_key}
		</if>
	</select>
	
	<select id="getInsAppList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  a.EDU_ORG_NAME,
		        (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY1_NAME,
		        (SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = a.CATEGORY2_KEY AND CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY2_NAME,
		        (SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = a.CATEGORY3_KEY AND CATEGORY2_KEY = a.CATEGORY2_KEY AND CATEGORY1_KEY = a.CATEGORY1_KEY) AS CATEGORY3_NAME,
		        a.EDU_TARGET, a.EDU_NUMBER, a.SCHEDULE_NO, a.REG_DT, CASE WHEN SCH_VIEW = '2' THEN '미노출' ELSE '노출' END AS SCH_VIEW,
		        (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = e.COPER_AREA_CD) AS AREA_NM,
		        CASE WHEN e.INS_TYPE = 'recruit' AND e.INS_STATUS IS NULL THEN '섭외중'
					WHEN e.INS_TYPE = 'recruit' AND e.INS_STATUS IS NOT NULL THEN '완료'
					WHEN e.INS_TYPE = 'select' AND e.INS_STATUS IS NULL THEN '완료'
				END
               AS INS_STATUS
		FROM EDU_SCHEDULE a,
			 EDU_REGISTRATION b,
		     EDU_SCHEDULE_DETAIL e
		WHERE a.EDU_KEY = b.EDU_NO
		AND a.SCHEDULE_NO = e.SCHEDULE_NO
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{org_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND e.COPER_AREA_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" category2_key !=null and category2_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY2_KEY =  #{category2_key}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY3_KEY =  #{category3_key}
		</if>
		ORDER BY a.SCHEDULE_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>

	<select id="getInsAppListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_SCHEDULE a,
			 EDU_REGISTRATION b,
		     EDU_SCHEDULE_DETAIL e
		WHERE a.EDU_KEY = b.EDU_NO
		AND a.SCHEDULE_NO = e.SCHEDULE_NO
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test=" org_type !=null and org_type !='' and org_type != 'ALL'">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{org_nm},'%')
		</if>
		<if test=" area_nm !=null and area_nm !=''">
			AND e.COPER_AREA_CD IN (SELECT CD FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD_NM LIKE CONCAT('%',#{area_nm},'%'))
		</if>
		<if test=" category2_key !=null and category2_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY2_KEY =  #{category2_key}
		</if>
		<if test=" category3_key !=null and category3_key !='' and category_chk != 'ALL'">
			AND a.CATEGORY3_KEY =  #{category3_key}
		</if>
	</select>
	
	<update id="instructorAdm03Edit" parameterType="java.util.Map">
		UPDATE EDU_SCHEDULE_DETAIL 
		   SET SCH_VIEW = #{gubun}
 		 WHERE SCHEDULE_NO = #{sch_no}
	</update>
	
    <select id="getInsLeaveList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (
			SELECT FN_DECRYPT(c.ENCPT_USER_NM) AS USER_NM, c.USER_ID,
				   (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = c.RGN_CD) AS AREA_NM, 
			       (SELECT LICENSE_NUMBER FROM EDU_USER_LICENSE WHERE CATEGORY1_KEY = '3' AND CATEGORY2_KEY = '7' AND USER_ID = c.USER_ID) AS LICENSE_NUMBER,
			       c.INSTR_INST_ND_ENTRPS_NM AS INSTRUCTOR_COPER_NM,
			       CASE WHEN a.REASON = '1' THEN '출산 및 육아' 
					   WHEN a.REASON = '2' THEN '병가' 
					   WHEN a.REASON = '3' THEN '해외연수' 
					   WHEN a.REASON = '4' THEN '기타' END AS REASON,
			       FN_DECRYPT(c.ENCPT_DADDR) AS JUSO, FN_DECRYPT(c.ENCPT_MBL_TELNO) AS MBL_TELNO, c.EML_ADDR, 
			       (SELECT FILE_NAME FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = a.INSTRUCTOR_LEAVE_IDX) AS FILE_NAME,
			       (SELECT FILE_ID FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = a.INSTRUCTOR_LEAVE_IDX) AS FILE_ID,
			       CASE WHEN a.STATUS = '1' THEN '승인'
						ELSE '미승인' END AS INS_STATUS,
					a.INSTRUCTOR_LEAVE_IDX
			FROM EDU_INSTRUCTOR_LEAVE a,
				 EDU_INSTRUCTOR b,
			     COM_USER c
			WHERE a.INSTRUCTOR_IDX = b.INSTRUCTOR_IDX
			AND b.COM_USER_ID = c.USER_ID
			<if test="reason !=null and reason !='' and reason !='ALL' ">
				AND a.REASON = #{reason}
			</if>
			<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				 
				<![CDATA[ AND a.S_DATE <= NOW() AND a.E_DATE >= NOW() ]]>
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[ AND  a.S_DATE >= #{start_date} AND a.E_DATE <= #{end_date} ]]>
			</when>
		</choose>
		) tb
		WHERE 1=1
		<if test="ins_type !=null and ins_type !='' and ins_type !='ALL' ">
			AND tb.USER_NM LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test="area_nm !=null and area_nm !=''">
			AND tb.AREA_NM LIKE CONCAT('%',#{area_nm},'%')
		</if>
		ORDER BY tb.INSTRUCTOR_LEAVE_IDX DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>

	<select id="getInsLeaveListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM (
			SELECT FN_DECRYPT(c.ENCPT_USER_NM) AS USER_NM, c.USER_ID,
				   (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = c.RGN_CD) AS AREA_NM, 
			       (SELECT LICENSE_NUMBER FROM EDU_USER_LICENSE WHERE CATEGORY1_KEY = '3' AND CATEGORY2_KEY = '7' AND USER_ID = c.USER_ID) AS LICENSE_NUMBER,
			       c.INSTR_INST_ND_ENTRPS_NM AS INSTRUCTOR_COPER_NM,
			       CASE WHEN a.REASON = '1' THEN '출산 및 육아' 
					   WHEN a.REASON = '2' THEN '병가' 
					   WHEN a.REASON = '3' THEN '해외연수' 
					   WHEN a.REASON = '4' THEN '기타' END AS REASON,
			       FN_DECRYPT(c.ENCPT_DADDR) AS JUSO, FN_DECRYPT(c.ENCPT_MBL_TELNO) AS MBL_TELNO, c.EML_ADDR, 
			       (SELECT FILE_NAME FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = a.INSTRUCTOR_LEAVE_IDX) AS FILE_NAME,
			       (SELECT FILE_ID FROM EDU_FILE WHERE FILE_GUBUN = 'insLeave' AND FILE_KEY = a.INSTRUCTOR_LEAVE_IDX) AS FILE_ID,
			       CASE WHEN a.STATUS = '1' THEN '승인'
						ELSE '미승인' END AS INS_STATUS,
					a.INSTRUCTOR_LEAVE_IDX
			FROM EDU_INSTRUCTOR_LEAVE a,
				 EDU_INSTRUCTOR b,
			     COM_USER c
			WHERE a.INSTRUCTOR_IDX = b.INSTRUCTOR_IDX
			AND b.COM_USER_ID = c.USER_ID
			<if test="reason !=null and reason !='' and reason !='ALL' ">
				AND a.REASON = #{reason}
			</if>
			<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				 
				<![CDATA[ AND a.S_DATE <= NOW() AND a.E_DATE >= NOW() ]]>
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[ AND  a.S_DATE >= #{start_date} AND a.E_DATE <= #{end_date} ]]>
			</when>
		</choose>
		) tb
		WHERE 1=1
		<if test="ins_type !=null and ins_type !='' and ins_type !='ALL' ">
			AND tb.USER_NM LIKE CONCAT('%',#{ins_nm},'%')
		</if>
		<if test="area_nm !=null and area_nm !=''">
			AND tb.AREA_NM LIKE CONCAT('%',#{area_nm},'%')
		</if>
	</select>
	
	<update id="instructorAdm04App" parameterType="java.util.Map">
		UPDATE EDU_INSTRUCTOR_LEAVE 
		   SET STATUS = 1
 		 WHERE INSTRUCTOR_LEAVE_IDX = #{idx}
	</update>
</mapper>
